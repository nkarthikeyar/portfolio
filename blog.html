<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="expires" content="0">
  <title>BlogHub - Professional Story Publishing Platform</title>
  <link rel="stylesheet" href="blog.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="blog-container">
    <!-- Premium Header -->
    <header class="premium-header">
      <div class="header-top">
        <div class="logo-section">
          <div class="logo-icon">
            <i class="fas fa-feather"></i>
          </div>
          <div class="logo-text">
            <h1>BlogHub</h1>
            <p>Share Your Stories</p>
          </div>
        </div>
        <div class="header-stats">
          <div class="stat">
            <i class="fas fa-file-alt"></i>
            <span id="draftCount">0</span> Drafts
          </div>
          <div class="stat">
            <i class="fas fa-globe"></i>
            <span id="publishedCount">0</span> Published
          </div>
        </div>
        <div class="user-section">
          <a href="/admin/admin.html" class="btn-admin" style="background: #7c3aed; color: white; padding: 8px 16px; border-radius: 8px; text-decoration: none; margin-right: 10px; display: inline-block;" target="_blank">
            <i class="fas fa-user-shield"></i> Admin
          </a>
          <div class="user-avatar">
            <i class="fas fa-user-circle"></i>
          </div>
          <div class="user-details">
            <span class="user-name" id="currentUser">User</span>
            <button class="logout-btn" onclick="logoutUser()">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Editor Area -->
    <main class="blog-editor-main">
      <div class="editor-wrapper">
        <!-- Left Toolbar -->
        <aside class="editor-toolbar">
          <div class="toolbar-section">
            <h4><i class="fas fa-palette"></i> Format</h4>
            <div class="tool-grid">
              <button class="tool-btn" title="Bold" data-format="bold"><i class="fas fa-bold"></i></button>
              <button class="tool-btn" title="Italic" data-format="italic"><i class="fas fa-italic"></i></button>
              <button class="tool-btn" title="Underline" data-format="underline"><i class="fas fa-underline"></i></button>
              <button class="tool-btn" title="Strike" data-format="strikethrough"><i class="fas fa-strikethrough"></i></button>
              <button class="tool-btn" title="Heading" data-format="heading"><i class="fas fa-heading"></i></button>
              <button class="tool-btn" title="Quote" data-format="quote"><i class="fas fa-quote-left"></i></button>
              <button class="tool-btn" title="List" data-format="list"><i class="fas fa-list"></i></button>
              <button class="tool-btn" title="Link" data-format="link"><i class="fas fa-link"></i></button>
            </div>
          </div>

          <div class="toolbar-section">
            <h4><i class="fas fa-chart-bar"></i> Stats</h4>
            <div class="stats-box">
              <div class="stat-item">
                <i class="fas fa-pencil-alt"></i>
                <div>
                  <span class="stat-label">Words</span>
                  <span class="stat-value" id="wordCount">0</span>
                </div>
              </div>
              <div class="stat-item">
                <i class="fas fa-keyboard"></i>
                <div>
                  <span class="stat-label">Chars</span>
                  <span class="stat-value" id="charCount">0</span>
                </div>
              </div>
              <div class="stat-item">
                <i class="fas fa-clock"></i>
                <div>
                  <span class="stat-label">Read Time</span>
                  <span class="stat-value" id="readTime">0 min</span>
                </div>
              </div>
            </div>
          </div>

          <div class="toolbar-section">
            <h4><i class="fas fa-lightbulb"></i> Tips</h4>
            <ul class="tips-list">
              <li>‚ú® Start with a hook</li>
              <li>üìù Use short paragraphs</li>
              <li>üéØ Add clear headings</li>
              <li>üí° Include visuals</li>
              <li>üìå End with takeaway</li>
            </ul>
          </div>
        </aside>

        <!-- Center Editor -->
        <section class="editor-center">
          <form id="createBlogForm" class="blog-form">
            <!-- Title Input -->
            <div class="title-input-wrapper">
              <input 
                type="text" 
                id="blog-title" 
                class="blog-title-input"
                placeholder="Give your story a captivating title..." 
                maxlength="150"
                required
              >
              <span class="char-counter" id="titleCount">0/150</span>
            </div>

            <!-- Featured Image -->
            <div class="featured-image-section">
              <div class="image-placeholder" id="imagePlaceholder">
                <i class="fas fa-image"></i>
                <p>Add featured image</p>
                <input type="url" id="blog-image" placeholder="https://example.com/image.jpg" style="display:none;">
              </div>
            </div>

            <!-- Meta Information -->
            <div class="meta-grid">
              <div class="meta-field">
                <label>Category</label>
                <select id="blog-category" class="meta-input">
                  <option value="">Choose category...</option>
                  <option value="Technology">üñ•Ô∏è Technology</option>
                  <option value="Business">üíº Business</option>
                  <option value="Lifestyle">üåü Lifestyle</option>
                  <option value="Travel">‚úàÔ∏è Travel</option>
                  <option value="Health">üí™ Health</option>
                  <option value="Education">üìö Education</option>
                  <option value="Creative">üé® Creative</option>
                </select>
              </div>
              <div class="meta-field">
                <label>Reading Level</label>
                <select id="blog-level" class="meta-input">
                  <option value="beginner">Beginner</option>
                  <option value="intermediate">Intermediate</option>
                  <option value="advanced">Advanced</option>
                </select>
              </div>
            </div>

            <!-- Excerpt -->
            <div class="section">
              <label class="section-label">Story Excerpt</label>
              <textarea 
                id="blog-excerpt" 
                class="input-textarea excerpt-textarea"
                placeholder="Write a compelling summary (2-3 sentences) that will hook readers..."
                maxlength="250"
                required
              ></textarea>
              <span class="char-counter" id="excerptCount">0/250</span>
            </div>

            <!-- Main Content -->
            <div class="section">
              <label class="section-label">Your Story</label>
              <textarea 
                id="blog-content" 
                class="input-textarea content-textarea"
                placeholder="Start writing your amazing story here...

Write freely and let your creativity flow. Your readers are waiting to hear your unique voice and perspective."
                maxlength="5000"
                required
              ></textarea>
              <span class="char-counter" id="contentCount">0/5000</span>
            </div>

            <!-- Tags -->
            <div class="section">
              <label class="section-label">Tags</label>
              <input 
                type="text" 
                id="blog-tags" 
                class="input-text"
                placeholder="Add tags separated by commas (e.g., coding, tips, tutorial)"
              >
              <p class="help-text">Tags help readers discover your post</p>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <button type="submit" class="btn-primary">
                <i class="fas fa-paper-plane"></i> Send to Admin for Approval
              </button>
              <button type="button" class="btn-secondary" onclick="saveDraft()">
                <i class="fas fa-save"></i> Save Draft
              </button>
              <button type="button" class="btn-tertiary" onclick="previewBlog()">
                <i class="fas fa-eye"></i> Preview
              </button>
            </div>
          </form>
        </section>

        <!-- Right Preview Panel -->
        <aside class="preview-panel">
          <div class="preview-header">
            <h3><i class="fas fa-newspaper"></i> Preview</h3>
          </div>
          
          <div class="preview-card">
            <div class="preview-image" id="previewImage">
              <i class="fas fa-image"></i>
            </div>
            
            <div class="preview-content">
              <span class="preview-category" id="previewCategory">Category</span>
              <h2 class="preview-title" id="previewTitle">Your captivating title goes here</h2>
              <p class="preview-excerpt" id="previewExcerpt">Your story excerpt will appear here...</p>
              
              <div class="preview-meta">
                <span><i class="fas fa-clock"></i> <span id="previewReadTime">0</span> min read</span>
                <span><i class="fas fa-pencil-alt"></i> <span id="previewWordCount">0</span> words</span>
              </div>
              
              <div class="preview-tags" id="previewTags">
              </div>
            </div>
          </div>

          <div class="preview-info">
            <i class="fas fa-info-circle"></i>
            <p>This is how your story will appear to readers</p>
          </div>
        </aside>
      </div>
    </main>
  </div>

  <!-- My Blogs Section -->
  <section style="max-width: 1200px; margin: 40px auto; padding: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 style="color: white; margin: 0;">My Blogs</h2>
      <button onclick="document.getElementById('createBlogForm').scrollIntoView({behavior: 'smooth'})" style="background: #3b82f6; color: white; padding: 8px 16px; border: none; border-radius: 8px; cursor: pointer;">
        <i class="fas fa-arrow-up"></i> Write New Blog
      </button>
    </div>
    <div id="myBlogsList" style="display: grid; gap: 20px;">
      <p style="color: #94a3b8;">Loading your blogs...</p>
    </div>
  </section>

  <!-- Preview Modal -->
  <div id="previewModal" class="modal-overlay" style="display: none;">
    <div class="modal-container">
      <div class="modal-header">
        <h2>Story Preview</h2>
        <button type="button" class="modal-close" onclick="closePreview()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <article class="story-preview">
          <h1 id="fullPreviewTitle"></h1>
          <div class="preview-meta-info">
            <span id="fullPreviewCategory" class="badge"></span>
            <span id="fullPreviewReadTime" class="badge"></span>
          </div>
          <div id="fullPreviewContent" class="story-content"></div>
          <div class="story-tags">
            <span>Tags:</span>
            <span id="fullPreviewTags"></span>
          </div>
        </article>
      </div>
    </div>
  </div>

  <script>
    window.BACKEND_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000' : window.location.origin;
    
    // Load user's blogs on page load
    function loadMyBlogsInline() {
      const userEmail = localStorage.getItem('userEmail');
      if (!userEmail) return;
      
      const API_URL = window.BACKEND_URL;
      const blogsList = document.getElementById('myBlogsList');
      
      fetch(`${API_URL}/api/blogs?userEmail=${encodeURIComponent(userEmail)}`)
        .then(res => res.json())
        .then(data => {
          if (data.success && data.blogs) {
            const myBlogs = data.blogs.filter(blog => 
              blog.author?.email?.toLowerCase() === userEmail.toLowerCase()
            );
            
            if (myBlogs.length === 0) {
              blogsList.innerHTML = '<p style="color: #94a3b8;">You haven\'t written any blogs yet. Start writing above!</p>';
              return;
            }
            
            blogsList.innerHTML = myBlogs.map(blog => {
              const statusBadge = blog.status === 'approved' 
                ? '<span style="background: #166534; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px;">‚úì Approved</span>'
                : '<span style="background: #92400e; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px;">‚è≥ Pending Approval</span>';
              
              return `
                <div style="background: #1e293b; padding: 20px; border-radius: 12px; border: 1px solid #334155;">
                  <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                    <h3 style="color: white; margin: 0;">${blog.title}</h3>
                    ${statusBadge}
                  </div>
                  <p style="color: #cbd5e1; margin: 10px 0;">${blog.excerpt}</p>
                  <div style="display: flex; gap: 10px; color: #94a3b8; font-size: 13px;">
                    <span>üìÅ ${blog.category || 'Uncategorized'}</span>
                    <span>üìÖ ${new Date(blog.createdAt).toLocaleDateString()}</span>
                  </div>
                </div>
              `;
            }).join('');
          } else {
            blogsList.innerHTML = '<p style="color: #f87171;">Error loading blogs</p>';
          }
        })
        .catch(error => {
          console.error('Error:', error);
          blogsList.innerHTML = '<p style="color: #f87171;">Failed to load blogs</p>';
        });
    }
    
    // Load blogs when page loads
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(loadMyBlogsInline, 1000);
    });
  </script>
  <script src="blog.js"></script>
</body>
</html>
